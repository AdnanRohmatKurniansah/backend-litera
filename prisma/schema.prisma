// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url = env("DATABASE_URL")
}

enum Role {
  Superadmin
  Staff
}

model Admin {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  name String 
  username String @unique
  email String? @unique
  password String
  profile String?
  phone String?
  role Role @default(Staff)
  tokenVersion Int @default(0)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

enum Provider {
  Email
  Google
}

model Users {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  name String?
  email String @unique
  password String
  profile String?
  phone String?
  provider Provider @default(Email)
  tokenVersion Int @default(0)
  created_at DateTime @default(now())

  carts Cart[]
  orders Order[]
  addresses Address[]
  reviews Review[]
}

model Categories {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  name String
  slug String @unique
  image_url String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  books Books[]
}

model Books {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  name String
  slug String @unique
  categoryId String @db.ObjectId
  desc String
  author String
  publisher String
  published_at DateTime
  language String
  page Int
  length Float
  width Float
  weight Float
  price Int
  discount_price Int?
  qty Int @default(10)
  image_url String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  
  category Categories @relation(fields: [categoryId], references: [id])
  cartItems CartItem[]
  orderItems OrderItem[]
  reviews Review[]
  bookImages BookImages[]
}

model BookImages {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  bookId String @db.ObjectId
  title String
  image_url String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  book Books @relation(fields: [bookId], references: [id])
}

model Articles {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  title String 
  slug String @unique
  content String
  image_url String
  published_at DateTime
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model Cart {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId
  created_at DateTime @default(now())

  user Users @relation(fields: [userId], references: [id])
  items CartItem[]
}

model CartItem {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  cartId String @db.ObjectId
  bookId String @db.ObjectId
  qty Int
  created_at DateTime @default(now())

  cart Cart @relation(fields: [cartId], references: [id])
  book Books @relation(fields: [bookId], references: [id])
}

enum OrderStatus {
  Pending
  Paid
  Processing
  Shipped
  Completed
  Cancelled
}

model Order {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  addressId String? @db.ObjectId
  status OrderStatus @default(Pending)
  total Int
  note String?
  created_at DateTime @default(now())

  user Users @relation(fields: [userId], references: [id])
  items OrderItem[]
  payment Payment?
  address Address? @relation(fields: [addressId], references: [id])
  shipping Shipping?
}

model OrderItem {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  orderId String @db.ObjectId
  bookId String @db.ObjectId
  price Int
  qty Int
  created_at DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id])
  book Books @relation(fields: [bookId], references: [id])
}

enum Courier {
  JNE
  POS
  TIKI
  JNT
  SICEPAT
  ANTERAJA
}

model Shipping {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  courier Courier
  service String
  description String
  cost Int
  etd String
  orderId String @unique @db.ObjectId
  created_at DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id])
}

enum PaymentStatus {
  Pending
  Paid
  Failed
}

model Payment {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  orderId String @unique @db.ObjectId
  method String
  status PaymentStatus @default(Pending)
  token String?
  paid_at DateTime?

  order Order @relation(fields: [orderId], references: [id])
}

model Address {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  name String
  phone String
  province String
  city String
  district String
  street String
  zip String
  is_primary Boolean @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user Users @relation(fields: [userId], references: [id])
  orders Order[]
}

model Review {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  bookId String @db.ObjectId
  rating Int
  comment String?
  created_at DateTime @default(now())

  user Users @relation(fields: [userId], references: [id])
  book Books @relation(fields: [bookId], references: [id])
}
